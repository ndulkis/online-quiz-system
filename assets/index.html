<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f8f9fa;
            color: #333;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header */
        header {
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 0;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #4361ee;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 5px;
        }

        .nav-links a:hover {
            background: #f0f2f5;
        }

        .nav-links a.active {
            background: #4361ee;
            color: white;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Main Content */
        main {
            padding: 30px 0;
            min-height: 70vh;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #4361ee;
            color: white;
        }

        .btn-success {
            background: #06d6a0;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: #4361ee;
        }

        /* Quiz Cards */
        .quiz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .quiz-card {
            transition: transform 0.2s;
        }

        .quiz-card:hover {
            transform: translateY(-5px);
        }

        .quiz-meta {
            color: #666;
            font-size: 14px;
            margin: 10px 0;
        }

        /* Quiz Taking */
        .question {
            margin: 20px 0;
        }

        .option {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .option:hover {
            background: #e9ecef;
        }

        .option.selected {
            border-color: #4361ee;
            background: #e7f0ff;
        }

        .quiz-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #4361ee;
            color: white;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Login/Register */
        .auth-container {
            max-width: 400px;
            margin: 50px auto;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: #f0f2f5;
            cursor: pointer;
            font-weight: 500;
        }

        .auth-tab.active {
            background: white;
            border-bottom: 3px solid #4361ee;
        }

        /* Footer */
        footer {
            background: #333;
            color: white;
            padding: 40px 0 20px;
            margin-top: 50px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-links a {
            color: #ddd;
            text-decoration: none;
            display: block;
            margin: 8px 0;
        }

        .footer-links a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #444;
            color: #999;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .quiz-grid {
                grid-template-columns: 1fr;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo">Quiz System</a>
                
                <ul class="nav-links">
                    <li><a href="#" onclick="showPage('dashboard')" class="active">Dashboard</a></li>
                    <li><a href="#" onclick="showPage('quizzes')">Quizzes</a></li>
                    <li><a href="#" onclick="showPage('leaderboard')">Leaderboard</a></li>
                    <li><a href="#" onclick="showPage('create')">Create Quiz</a></li>
                    <li><a href="#" onclick="checkAndShowProfile(); return false;">Profile</a></li>
                </ul>
                
                <div class="user-menu">
                    <span>Welcome, User</span>
                    <a href="#" id="auth-btn" class="btn btn-primary btn-small"></a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Dashboard -->
            <div id="dashboard" class="page active">
                <h1>Welcome to Quiz System</h1>
                <p>Test your knowledge and track your progress!</p>
                
                <div class="card">
                    <h2>Your Stats</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div>
                            <h3 id="dash-quizzes">-</h3>
                            <p>Quizzes Taken</p>
                        </div>
                        <div>
                            <h3 id="dash-average">-</h3>
                            <p>Average Score</p>
                        </div>
                        <div>
                            <h3 id="dash-rank">-</h3>
                            <p>Global Rank</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>Recent Activity</h2>
                    <div id="recent-activity" class="quiz-grid">
                        <!-- Recent attempts will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Quizzes Page -->
            <div id="quizzes" class="page">
                <h1>Available Quizzes</h1>
                
                <div class="card">
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-primary btn-small" onclick="filterQuizzes('all')">All</button>
                        <button class="btn btn-secondary btn-small" onclick="filterQuizzes('programming')">Programming</button>
                        <button class="btn btn-secondary btn-small" onclick="filterQuizzes('general')">General</button>
                        <button class="btn btn-secondary btn-small" onclick="filterQuizzes('science')">Science</button>
                    </div>
                    
                    <div class="quiz-grid" id="quiz-list">
                        <!-- Quizzes will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Leaderboard -->
            <div id="leaderboard" class="page">
                <h1>Leaderboard</h1>
                
                <div class="card">
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-primary btn-small" onclick="loadLeaderboard('global')">Global</button>
                        <button class="btn btn-secondary btn-small" onclick="loadLeaderboard('monthly')">Monthly</button>
                        <button class="btn btn-secondary btn-small" onclick="loadLeaderboard('weekly')">Weekly</button>
                    </div>
                    
                    <table id="leaderboard-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>User</th>
                                <th>Score</th>
                                <th>Quizzes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Leaderboard data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Create Quiz -->
            <div id="create" class="page">
                <h1>Create New Quiz</h1>

                <div class="card">
                    <form id="create-quiz-form" onsubmit="createQuiz(event)">
                        <div class="form-group">
                            <label for="quiz-title">Quiz Title</label>
                            <input type="text" id="quiz-title" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label for="quiz-description">Description</label>
                            <textarea id="quiz-description" class="form-control" rows="3"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="quiz-category">Category</label>
                            <select id="quiz-category" class="form-control" required>
                                <option value="">Select Category</option>
                                <option value="programming">Programming</option>
                                <option value="science">Science</option>
                                <option value="mathematics">Mathematics</option>
                                <option value="general">General Knowledge</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="quiz-time">Time Limit (minutes)</label>
                            <input type="number" id="quiz-time" class="form-control" min="1" max="60" value="10">
                        </div>

                        <button type="submit" class="btn btn-primary">Create Quiz</button>
                    </form>
                </div>
            </div>

            <!-- Profile -->
            <div id="profile" class="page">
                <h1>Your Profile</h1>
                
                <div class="card">
                    <div style="display: flex; gap: 20px; align-items: center; margin-bottom: 20px;">
                        <div id="avatar" style="width: 80px; height: 80px; background: #4361ee; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold;">
                            
                        </div>
                        <div>
                            <h2 id="profile-name">-</h2>
                            <p id="profile-email">-</p>
                            <p id="profile-member-date">Member since: -</p>
                        </div>
                    </div>
                    
                    <h3>Performance Stats</h3>
                    <table>
                        <tr>
                            <td>Total Quizzes Taken</td>
                            <td id="stat-quizzes">0</td>
                        </tr>
                        <tr>
                            <td>Average Score</td>
                            <td id="stat-average">0%</td>
                        </tr>
                        <tr>
                            <td>Highest Score</td>
                            <td id="stat-highest">0%</td>
                        </tr>
                        <tr>
                            <td>Total Time Spent</td>
                            <td id="stat-time">0h 0m</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Login/Register -->
            <div id="login" class="page">
                <div class="auth-container">
                    <div class="card">
                        <div class="auth-tabs">
                            <div class="auth-tab active" onclick="showAuthTab('login')">Login</div>
                            <div class="auth-tab" onclick="showAuthTab('register')">Register</div>
                        </div>
                        
                        <!-- Login Form -->
                        <form id="login-form" onsubmit="login(event)">
                            <div class="form-group">
                                <label for="login-email">Email</label>
                                <input type="email" id="login-email" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="login-password">Password</label>
                                <input type="password" id="login-password" class="form-control" required>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                        </form>
                        
                        <!-- Register Form -->
                        <form id="register-form" onsubmit="register(event)" style="display: none;">
                            <div class="form-group">
                                <label for="register-name">Full Name</label>
                                <input type="text" id="register-name" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="register-email">Email</label>
                                <input type="email" id="register-email" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="register-password">Password</label>
                                <input type="password" id="register-password" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="register-confirm">Confirm Password</label>
                                <input type="password" id="register-confirm" class="form-control" required>
                            </div>
                            
                            <button type="submit" class="btn btn-success" style="width: 100%;">Register</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Quiz Taking -->
            <div id="quiz-taking" class="page">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h1 id="quiz-title">Quiz Title</h1>
                            <p>Question <span id="current-q">1</span> of <span id="total-q">10</span></p>
                        </div>
                        <div id="quiz-timer" style="background: #333; color: white; padding: 10px 20px; border-radius: 5px; font-weight: bold;">
                            10:00
                        </div>
                    </div>
                    
                    <div class="progress" style="height: 5px; background: #ddd; margin-bottom: 20px;">
                        <div id="progress-bar" style="height: 100%; background: #4361ee; width: 10%;"></div>
                    </div>
                    
                    <div class="question">
                        <h2 id="question-text">Question text will appear here</h2>
                    </div>
                    
                    <div id="options-container">
                        <!-- Options will be loaded here -->
                    </div>
                    
                    <div class="quiz-nav">
                        <button class="btn btn-secondary" onclick="prevQuestion()">Previous</button>
                        <button class="btn btn-primary" onclick="nextQuestion()">Next</button>
                    </div>
                </div>
            </div>

            <!-- Results -->
            <div id="results" class="page">
                <div class="card">
                    <div style="text-align: center;">
                        <h1>Quiz Completed!</h1>
                        <h2 id="quiz-results-title">Quiz Title</h2>
                        
                        <div style="font-size: 48px; color: #4361ee; margin: 20px 0;" id="score-display">
                            85%
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin: 30px 0;">
                            <div>
                                <h3>Correct</h3>
                                <p id="correct-answers">17/20</p>
                            </div>
                            <div>
                                <h3>Time</h3>
                                <p id="time-taken">12:30</p>
                            </div>
                            <div>
                                <h3>Rank</h3>
                                <p id="quiz-rank">#42</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button class="btn btn-primary" onclick="showPage('dashboard')">Dashboard</button>
                            <button class="btn btn-secondary" onclick="showPage('quizzes')">More Quizzes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div>
                    <h3>Quiz System</h3>
                    <p>A comprehensive platform for creating and taking quizzes.</p>
                </div>
                
                <div>
                    <h3>Quick Links</h3>
                    <div class="footer-links">
                        <a href="#" onclick="showPage('dashboard')">Dashboard</a>
                        <a href="#" onclick="showPage('quizzes')">Quizzes</a>
                        <a href="#" onclick="showPage('leaderboard')">Leaderboard</a>
                    </div>
                </div>
                
                <div>
                    <h3>Contact</h3>
                    <div class="footer-links">
                        <a href="mailto:support@quizsystem.com">support@quizsystem.com</a>
                        <a href="#">Help Center</a>
                        <a href="#">About Us</a>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2024 Quiz System. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // Database structure for PHP/MySQL integration
        
        /*
        MySQL Tables Needed:
        
        1. users
           - id (INT, PK, AI)
           - name (VARCHAR)
           - email (VARCHAR, UNIQUE)
           - password (VARCHAR)
           - created_at (TIMESTAMP)
        
        2. quizzes
           - id (INT, PK, AI)
           - title (VARCHAR)
           - description (TEXT)
           - category (VARCHAR)
           - time_limit (INT)
           - created_by (INT, FK to users.id)
           - created_at (TIMESTAMP)
        
        3. questions
           - id (INT, PK, AI)
           - quiz_id (INT, FK to quizzes.id)
           - question_text (TEXT)
           - option_a (VARCHAR)
           - option_b (VARCHAR)
           - option_c (VARCHAR)
           - option_d (VARCHAR)
           - correct_option (CHAR)
        
        4. quiz_attempts
           - id (INT, PK, AI)
           - user_id (INT, FK to users.id)
           - quiz_id (INT, FK to quizzes.id)
           - score (INT)
           - time_taken (INT)
           - completed_at (TIMESTAMP)
        
        5. user_answers
           - id (INT, PK, AI)
           - attempt_id (INT, FK to quiz_attempts.id)
           - question_id (INT, FK to questions.id)
           - selected_option (CHAR)
           - is_correct (BOOLEAN)
        */

        // Page Navigation
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Add active class to clicked nav link if it exists
            if(pageName !== 'login' && pageName !== 'quiz-taking' && pageName !== 'results') {
                document.querySelector(`.nav-links a[onclick*="${pageName}"]`)?.classList.add('active');
            }
            
            // Show selected page
            document.getElementById(pageName).classList.add('active');
            
            // Load data for specific pages
            if(pageName === 'quizzes') {
                loadQuizzes();
            } else if(pageName === 'leaderboard') {
                loadLeaderboard('global');
            }
        }

        // Check if user is logged in before showing profile
        function checkAndShowProfile() {
            if (currentUser) {
                loadUserProfile();
                showPage('profile');
            } else {
                alert('Please login to see your profile');
                showPage('login');
            }
        }

        // Load user profile data from database
        function loadUserProfile() {
            if (!currentUser) return;

            fetch('get_user_profile.php?user_id=' + currentUser.id)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const profile = data.profile;

                        // Update profile info
                        const initials = profile.name.split(' ').map(n => n[0]).join('').toUpperCase();
                        document.getElementById('avatar').textContent = initials;
                        document.getElementById('profile-name').textContent = profile.name;
                        document.getElementById('profile-email').textContent = profile.email;
                        document.getElementById('profile-member-date').textContent = 'Member since: ' + profile.memberSince;

                        // Update stats
                        document.getElementById('stat-quizzes').textContent = profile.totalQuizzes;
                        document.getElementById('stat-average').textContent = profile.averageScore;
                        document.getElementById('stat-highest').textContent = profile.highestScore;
                        document.getElementById('stat-time').textContent = profile.timeSpent;
                    } else {
                        console.error('Error loading profile:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error loading profile:', error);
                });
        }

        // Auth Tabs
        function showAuthTab(tab) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const tabs = document.querySelectorAll('.auth-tab');
            
            tabs.forEach(t => t.classList.remove('active'));
            
            if(tab === 'login') {
                document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            } else {
                document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            }
        }

        // Login Function (To be connected to PHP)
        // Global variable to store logged-in user
        let currentUser = null;

        // Login Function
        function login(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            fetch('auth.php?action=login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({email, password})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentUser = data.user;
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    // Update UI to show logged-in user
                    updateUserUI();
                    
                    // Clear form
                    document.getElementById('login-form').reset();
                    
                    // Show success message
                    alert('Welcome ' + data.user.name + '! You have successfully logged in.');
                    
                    // Navigate to dashboard
                    showPage('dashboard');
                } else {
                    alert('Login failed: ' + (data.message || 'Invalid credentials'));
                }
            })
            .catch(error => {
                console.error('Login error:', error);
                alert('Error during login. Please try again.');
            });
        }

        // Register Function
        function register(event) {
            event.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            
            if(password !== confirm) {
                alert('Passwords do not match!');
                return;
            }
            
            fetch('auth.php?action=register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({name, email, password, confirm})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    document.getElementById('register-form').reset();
                    showAuthTab('login');
                } else {
                    alert('Registration failed: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Register error:', error);
                alert('Error during registration. Please try again.');
            });
        }

        // Update UI to show logged-in user
        function updateUserUI() {
            const authBtn = document.getElementById('auth-btn');
            
            if (currentUser) {
                document.querySelector('.user-menu span').textContent = 'Welcome, ' + currentUser.name;
                authBtn.textContent = 'Logout';
                authBtn.onclick = function(e) { e.preventDefault(); logout(); return false; };
                
                // Update profile section
                const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                document.getElementById('avatar').textContent = initials;
                document.getElementById('profile-name').textContent = currentUser.name;
                document.getElementById('profile-email').textContent = currentUser.email;
                document.getElementById('profile-member-date').textContent = 'Member since: ' + new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                
                // Load stats from database
                loadUserStats();
                loadRecentActivity();
            } else {
                document.querySelector('.user-menu span').textContent = 'Welcome, User';
                authBtn.textContent = 'Login';
                authBtn.onclick = function(e) { e.preventDefault(); showPage('login'); return false; };
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('user');
            document.getElementById('login-form').reset();
            document.getElementById('register-form').reset();
            
            // Clear profile data
            document.getElementById('avatar').textContent = '';
            document.getElementById('profile-name').textContent = '-';
            document.getElementById('profile-email').textContent = '-';
            document.getElementById('profile-member-date').textContent = 'Member since: -';
            document.getElementById('stat-quizzes').textContent = '0';
            document.getElementById('stat-average').textContent = '0%';
            document.getElementById('stat-highest').textContent = '0%';
            document.getElementById('stat-time').textContent = '0h 0m';
            document.getElementById('dash-quizzes').textContent = '-';
            document.getElementById('dash-average').textContent = '-';
            document.getElementById('dash-rank').textContent = '-';
            document.getElementById('recent-activity').innerHTML = '';
            
            showPage('login');
            updateUserUI();
        }

        // Load Quizzes from Database
        function loadQuizzes(category = 'all') {
            const quizList = document.getElementById('quiz-list');
            
            // Fetch quizzes from PHP backend
            const url = category === 'all' ? 'get_quizzes.php' : `get_quizzes.php?category=${category}`;
            
            fetch(url)
                .then(response => response.json())
                .then(quizzes => {
                    quizList.innerHTML = quizzes.map(quiz => `
                        <div class="quiz-card card">
                            <h3>${quiz.title}</h3>
                            <div class="quiz-meta">
                                Category: ${quiz.category} | 
                                Questions: ${quiz.questions} | 
                                Time: ${quiz.time} min
                            </div>
                            <p>${quiz.description || 'Test your knowledge'}</p>
                            <a href="#" class="btn btn-primary btn-small" onclick="startQuiz(${quiz.id})">Start Quiz</a>
                        </div>
                    `).join('');
                })
                .catch(error => {
                    console.error('Error loading quizzes:', error);
                    quizList.innerHTML = '<p>Error loading quizzes. Please check your database connection.</p>';
                });
        }

        function filterQuizzes(category) {
            // Update button styles to show active category
            const quizButtons = document.querySelectorAll('#quizzes .btn-small');
            quizButtons.forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });

            // Set the clicked button as active
            const activeButton = Array.from(quizButtons).find(btn =>
                btn.textContent.toLowerCase() === category.toLowerCase() ||
                (category === 'all' && btn.textContent.toLowerCase() === 'all')
            );
            if (activeButton) {
                activeButton.classList.remove('btn-secondary');
                activeButton.classList.add('btn-primary');
            }

            loadQuizzes(category);
        }

        // Load User Stats from Database (for dashboard only)
        function loadUserStats() {
            if (!currentUser) return;

            fetch('get_user_stats.php?user_id=' + currentUser.id)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.stats) {
                        const stats = data.stats;
                        // Update dashboard stats
                        document.getElementById('dash-quizzes').textContent = stats.quizzesTaken || '0';
                        document.getElementById('dash-average').textContent = stats.averageScore || '0%';
                        document.getElementById('dash-rank').textContent = stats.globalRank || '#-';
                    }
                })
                .catch(error => {
                    console.error('Error loading user stats:', error);
                });
        }

        // Load Recent Activity from Database
        function loadRecentActivity() {
            if (!currentUser) return;
            
            fetch('get_recent_activity.php?user_id=' + currentUser.id)
                .then(response => response.json())
                .then(attempts => {
                    const container = document.getElementById('recent-activity');
                    if (attempts.length === 0) {
                        container.innerHTML = '<p>No quiz attempts yet. Start a quiz to see your recent activity!</p>';
                        return;
                    }
                    
                    container.innerHTML = attempts.map(attempt => `
                        <div class="quiz-card card">
                            <h3>${attempt.quiz_title}</h3>
                            <div class="quiz-meta">Score: ${attempt.score}% | ${attempt.questions_count} Questions</div>
                            <p>${attempt.quiz_description}</p>
                            <a href="#" class="btn btn-primary btn-small" onclick="startQuiz(${attempt.quiz_id})">Retake Quiz</a>
                        </div>
                    `).join('');
                })
                .catch(error => {
                    console.error('Error loading recent activity:', error);
                    document.getElementById('recent-activity').innerHTML = '<p>Error loading recent activity.</p>';
                });
        }

        // Load Leaderboard
        function loadLeaderboard(period) {
            const tableBody = document.querySelector('#leaderboard-table tbody');

            // Update button styles to show active period
            const leaderboardButtons = document.querySelectorAll('#leaderboard .btn');
            leaderboardButtons.forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });

            // Set the clicked button as active
            const activeButton = Array.from(leaderboardButtons).find(btn =>
                btn.textContent.toLowerCase() === period.toLowerCase()
            );
            if (activeButton) {
                activeButton.classList.remove('btn-secondary');
                activeButton.classList.add('btn-primary');
            }

            // Fetch leaderboard data from PHP
            fetch('leaderboard.php?period=' + period)
                .then(response => response.json())
                .then(data => {
                    tableBody.innerHTML = data.map(row => `
                        <tr>
                            <td>${row.rank}</td>
                            <td>${row.name}</td>
                            <td>${row.score}</td>
                            <td>${row.quizzes}</td>
                        </tr>
                    `).join('');
                })
                .catch(error => {
                    console.error('Error loading leaderboard:', error);
                    tableBody.innerHTML = '<tr><td colspan="4">Error loading leaderboard</td></tr>';
                });
        }

        // Create Quiz - Admin feature
        function createQuiz(event) {
            event.preventDefault();

            const title = document.getElementById('quiz-title').value;
            const description = document.getElementById('quiz-description').value;
            const category = document.getElementById('quiz-category').value;
            const time = document.getElementById('quiz-time').value;

            // Show info about quiz creation
            alert(`Quiz Information Saved!\n\nTitle: ${title}\nCategory: ${category}\nTime Limit: ${time} minutes\n\nNote: This is a demo feature. In a full implementation, this would save to the database with questions added through an admin interface.`);

            // Reset form
            document.getElementById('create-quiz-form').reset();
            showPage('dashboard');
        }

        // Quiz Taking Variables
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let timerInterval;

        // Start Quiz (To be connected to PHP)
        function startQuiz(quizId) {
            // Fetch quiz data from PHP
            fetch('get_quiz_questions.php?quiz_id=' + quizId)
                .then(response => response.json())
                .then(data => {
                    currentQuiz = data;
                    currentQuestionIndex = 0;
                    userAnswers = [];
                    
                    // Set quiz title
                    document.getElementById('quiz-title').textContent = currentQuiz.title;
                    document.getElementById('quiz-results-title').textContent = currentQuiz.title;
                    document.getElementById('total-q').textContent = currentQuiz.questions.length;
                    
                    // Start timer
                    startTimer(currentQuiz.time_limit || 10);
                    
                    // Load first question
                    loadQuestion();
                    
                    showPage('quiz-taking');
                })
                .catch(error => {
                    console.error('Error loading quiz:', error);
                    alert('Error loading quiz. Please try again.');
                });
        }

        function loadQuestion() {
            const question = currentQuiz.questions[currentQuestionIndex];
            
            // Update question counter
            document.getElementById('current-q').textContent = currentQuestionIndex + 1;
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / currentQuiz.questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            
            // Set question text
            document.getElementById('question-text').textContent = question.text;
            
            // Load options
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option';
                div.textContent = option;
                div.onclick = () => selectOption(div, index);
                
                // Check if this option was previously selected
                if(userAnswers[currentQuestionIndex] === index) {
                    div.classList.add('selected');
                }
                
                container.appendChild(div);
            });
        }

        function selectOption(element, index) {
            // Remove selected from all options
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selected to clicked option
            element.classList.add('selected');
            
            // Save answer
            userAnswers[currentQuestionIndex] = index;
        }

        function prevQuestion() {
            if(currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function nextQuestion() {
            if(currentQuestionIndex < currentQuiz.questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                // Submit quiz
                submitQuiz();
            }
        }

        function startTimer(minutes) {
            let time = minutes * 60;
            const timerElement = document.getElementById('quiz-timer');
            
            timerInterval = setInterval(() => {
                const minutes = Math.floor(time / 60);
                const seconds = time % 60;
                
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if(time <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
                
                time--;
            }, 1000);
        }

        function submitQuiz() {
            clearInterval(timerInterval);

            // Calculate score
            let correct = 0;
            currentQuiz.questions.forEach((question, index) => {
                if(userAnswers[index] === question.correct) {
                    correct++;
                }
            });

            const score = Math.round((correct / currentQuiz.questions.length) * 100);

            // Update results display
            document.getElementById('score-display').textContent = `${score}%`;
            document.getElementById('correct-answers').textContent = `${correct}/${currentQuiz.questions.length}`;

            // Save quiz results to database
            if (currentUser) {
                // Prepare answers in the format expected by the backend
                const answersData = {};
                currentQuiz.questions.forEach((question, index) => {
                    // Convert user answer index to option letter (0 -> 'A', 1 -> 'B', etc.)
                    const optionLetter = userAnswers[index] !== undefined
                        ? String.fromCharCode(65 + userAnswers[index])
                        : null;
                    answersData[question.id] = optionLetter;
                });

                // Calculate time taken (in seconds)
                const timerText = document.getElementById('quiz-timer').textContent;
                const [minutes, seconds] = timerText.split(':').map(Number);
                const timeLimit = (currentQuiz.time_limit || 10) * 60;
                const timeTaken = timeLimit - (minutes * 60 + seconds);

                // Send quiz results to the backend
                fetch('submit_quiz.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        quiz_id: currentQuiz.id,
                        answers: answersData,
                        time_taken: timeTaken
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Quiz results saved successfully');
                        // Reload recent activity and stats to show the new attempt
                        loadRecentActivity();
                        loadUserStats();
                    } else {
                        console.error('Error saving quiz results:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error submitting quiz:', error);
                });
            }

            showPage('results');
        }

        // Initialize - Check if user is logged in
        const savedUser = localStorage.getItem('user');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
        }
        
        // Setup UI
        updateUserUI();
        
        if (currentUser) {
            showPage('dashboard');
        } else {
            showPage('login');
        }
    </script>
</body>
</html>